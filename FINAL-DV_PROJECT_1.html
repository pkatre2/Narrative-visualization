<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <title>GradeInfluencers</title>
</head>
<body>
<h1>GradesVSAlcohol</h1>

<svg width="400" height="400" id="example4"></svg>
<div id="my_dataviz1" class="step a">
    <script>
        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 30, left: 60},
            width = 700 - margin.left - margin.right,
            height = 700 - margin.top - margin.bottom;
        // append the svg object to the body of the page
        var svg = d3.select("#my_dataviz1")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        //Read the data
        //d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/2_TwoNum.csv", function(data) {
        d3.csv("GradesVSAlcohol_Sheet.csv", function(data) {
            // Add X axis
            var x = d3.scaleLinear()
                .domain([0, 6])
                .range([ 0, width ]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, 14])
                .range([ height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));

            //Piyush Add
            var color = d3.scaleOrdinal()
                .domain(["F", "M" ])
                .range([ "#440154ff", "#21908dff"])

            // Highlight
            var highlight = function(d){

                selected_sex = d.Age

                d3.selectAll(".dot")
                    .transition()
                    .duration(200)
                    .style("fill", "lightgrey")
                    .attr("r", 100)

                d3.selectAll("." + selected_sex)
                    .transition()
                    .duration(200)
                    .style("fill", color(selected_sex))
                    .attr("r", 100)
            }

            // Highlight
            var doNotHighlight = function(){
                d3.selectAll(".dot")
                    .transition()
                    .duration(200)
                    .style("fill", "lightgrey")
                    .attr("r", 50 )
            }



            // ToolTip

            // create a tooltip
            var Tooltip = d3.select("#my_dataviz1")
                .append("div")
                .style("opacity", 0)
                .attr("class", "tooltip")
                .style("background-color", "white")
                .style("border", "solid")
                .style("border-width", "2px")
                .style("border-radius", "5px")
                .style("padding", "5px")

            // Three function that change the tooltip when user hover / move / leave a cell
            var mousemove = function(d) {
                Tooltip
                    .style("opacity", 1)
                d3.select(this).transition
                    .style("stroke", "black")
                    .style("opacity", 1)
            }
            var mouseover = function(d) {
                Tooltip
                    .html("Age:-<br>"+d.Age+"Sex:-<br>"+d.Sex)
                    .style("top",  (d3.mouse(this)[1]) + "px")
                    .style("right", (d3.mouse(this)[0]) + "px")
           }
            var mouseleave = function(d) {
                Tooltip
                    .style("opacity", 0)
                d3.select(this)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
            }


            //Annotation

            // ==== RIGHT ====== //
            const annotationsRight = [
                {
                    note: {
                        label: "Here is the annotation label",
                        title: "Annotation title"
                    },
                    type: d3.annotationCalloutRect,
                    subject: {
                        width: 60,
                        height: 60
                    },
                    x: 220,
                    y: 130,
                    dy: 100,
                    dx: 100
                }
            ]

            // Add annotation to the chart
            const makeAnnotationsRight = d3.annotation()
                .annotations(annotationsRight)
            svg
                .append("g")
                .call(makeAnnotationsRight)


            // Add X axis label:
            svg.append("text")
                .attr("text-anchor", "end")
                .attr("x", width/2 + margin.left)
                .attr("y", height + margin.top + 20)
                .text("WorkDay Alcohol Consumption");

            // Y axis label:
            svg.append("text")
                .attr("text-anchor", "end")
                .attr("transform", "rotate(-90)")
                .attr("y", -margin.left + 20)
                .attr("x", -margin.top - height/2 + 20)
                .text("Final Grades")

            //Legend starts here
            // select the svg area
            //var svg = d3.select("#my_dataviz")

            // Handmade legend
            svg.append("circle").attr("cx",550).attr("cy",530).attr("r", 6).style("fill", "#440154ff")
            svg.append("circle").attr("cx",550).attr("cy",560).attr("r", 6).style("fill", "#21908dff")
            svg.append("text").attr("x", 570).attr("y", 530).text("F").style("font-size", "15px").attr("alignment-baseline","Right")
            svg.append("text").attr("x", 570).attr("y", 560).text("M").style("font-size", "15px").attr("alignment-baseline","Right")


            //piyush Finish

            // Add dots
            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.Dalc); } )
                .attr("cy", function (d) { return y(d.Grade); } )
                .attr("r", 3)
                //.style("fill", "#69b3a2")
                .style("fill", function (d) { return color(d.Sex) } )
               .on("mouseover", highlight)
                .on("mouseleave", doNotHighlight )
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
                .call(makeAnnotationsRight)

        })



    </script>
</div>
</body>
</html>